#!/bin/bash
set -e

echo "Setting up development environment..."

# Check if Docker is installed
if ! command -v docker &> /dev/null; then
    echo "Docker is not installed. Please install Docker first."
    exit 1
fi

# Check if docker-compose is installed
if ! command -v docker-compose &> /dev/null; then
    echo "docker-compose is not installed. Please install docker-compose first."
    exit 1
fi

# Build the development container
echo "Building development container..."
docker-compose build dev

# Install dependencies
echo "Installing dependencies in container..."
docker-compose run --rm dev bundle install

# Set up pre-commit hooks
if command -v pre-commit &> /dev/null; then
    echo "Installing pre-commit hooks..."
    pre-commit install
else
    echo "pre-commit not found. Install it with: pip install pre-commit"
fi

echo "Development environment setup complete!"
echo ""
echo "To run tests in Docker:"
echo "  ./bin/test-docker"
echo ""
echo "To enter the development container:"
echo "  docker-compose run --rm dev bash"
echo ""
echo "To run specific Test Kitchen suite:"
echo "  ./bin/test-docker default-ubuntu-22.04"